---
import { Image } from 'astro:assets';
import { NAV_LINKS, SOCIAL_LINKS } from '../../consts';
import HeaderLink from './HeaderLink.astro';
import ThemeToggle from '../ThemeToggle.astro';
import logoPrincipal from '../../assets/logo-principal.jpg';

const navLinks = [
    { href: '/', label: 'Inicio' },
    { href: NAV_LINKS.SERVICES, label: 'Servicios' },
    // { href: NAV_LINKS.USE_CASES, label: 'Casos de uso' },
    { href: NAV_LINKS.CONTACT, label: 'Contacto' },
];
---

<header class="sticky top-0 z-50 px-4 py-3 
    bg-guide-light
    dark:bg-cosmic-void
    border-b border-gray-300 dark:border-gray-800 
    shadow-md 
    text-cosmic-void dark:text-guide-light">
    <nav class="flex items-center justify-between mx-auto max-w-7xl">
        <div class="site-title flex items-center gap-3">
            <a href="/" class="flex items-center">
                <Image src={logoPrincipal} width={40} height={40} alt="MyCn18 Logo" loading="eager" class="rounded-full shadow-md" />
            </a>
            <span class="tagline text-sm font-semibold hidden md:block">
                Servicios de Arquitectura y Consultoría
            </span>
        </div>
            
            <button id="hamburger-menu" aria-label="Toggle navigation menu" class="md:hidden p-2 rounded-md hover:bg-nitrogen-red/10 dark:hover:bg-nitrogen-red/20 transition-colors">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-7 h-7">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        
            <div class="nav-menu hidden md:flex items-center gap-6">
            <div class="internal-links flex gap-4">
                {navLinks.map((link) => (
                    <HeaderLink href={link.href} class="p-2">
                        {link.label}
                    </HeaderLink>
                ))}
            </div>
            
            <div class="header-actions flex items-center gap-4">
                <div class="social-links flex gap-2">
                    {SOCIAL_LINKS.map((link) => (
                        <a 
                            href={link.href} 
                            target="_blank" 
                            aria-label={`Follow on ${link.name}`} 
                            title={`Follow on ${link.name}`}
                            style={`--hover-color: ${link.hoverColor};`}
                            class="p-1 hover:text-(--hover-color) transition-colors"
                        >
                            <span class="sr-only">Follow on {link.name}</span>
                            <svg 
                                role="img" 
                                viewBox="0 0 24 24" 
                                xmlns="http://www.w3.org/2000/svg"
                                aria-hidden="true"
                                width="24" 
                                height="24"
                                class="fill-current"
                            >
                                <title>{link.name}</title>
                                <path d={link.icon}/>
                            </svg>
                        </a>
                    ))}
                </div>
                <ThemeToggle />
            </div>
    </nav>
</header>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const hamburger = document.getElementById('hamburger-menu');
        const navMenu = document.querySelector('.nav-menu');
        const header = document.querySelector('header');

        if (!hamburger || !navMenu || !header) return;
        // Clonar solo los enlaces para el menú móvil
        const internalLinksContainer = navMenu?.querySelector('.internal-links');
        const navInnerHtml = internalLinksContainer ? internalLinksContainer.innerHTML : '';

         const mobileMenu = document.createElement('div');
            // Usar las clases genéricas de tema para que el script las aplique
         mobileMenu.className = 'mobile-menu-overlay hidden md:hidden absolute top-full left-0 right-0 p-4 shadow-xl z-40 transition-all duration-300';
         mobileMenu.innerHTML = `
             <div class="internal-links flex flex-col gap-2 mb-4">
                ${navInnerHtml}
             </div>
             <div class="social-links flex justify-center gap-4 border-t pt-4 border-gray-300 dark:border-gray-700">
                ${navInnerHtml}
             </div>
         `;
         header.insertAdjacentElement('afterend', mobileMenu);

         // Aplicar estilos de tema al menú móvil dinámicamente
         const updateMobileMenuTheme = () => {
            // Eliminar las clases de color anteriores
            mobileMenu.classList.remove('bg-guide-light', 'bg-cosmic-void', 'text-cosmic-void', 'text-guide-light');
        
            if (document.documentElement.classList.contains('dark')) {
                 // Modo Oscuro: Fondo oscuro (cosmic-void), texto claro (guide-light)
                 mobileMenu.classList.add('bg-cosmic-void', 'text-guide-light');
            } else {
                // Modo Claro: Fondo claro (guide-light), texto oscuro (cosmic-void)
                mobileMenu.classList.add('bg-guide-light', 'text-cosmic-void');
            }
         }

         // Aplicar tema inicial y registrar listener para el cambio de tema
         updateMobileMenuTheme();
         document.getElementById('theme-toggle')?.addEventListener('click', updateMobileMenuTheme);


        hamburger?.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
            mobileMenu.classList.toggle('block');
        });
    });
</script>